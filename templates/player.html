<!DOCTYPE html>
<html>
<head>
    <title>DHL Automation Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 10px; background: #e0e0e0; color: #333; }
        .box { background: white; padding: 20px; border-radius: 8px; margin-top: 20px; border-bottom: 5px solid #D40511; }
        input[type=text] { padding: 10px; font-size: 16px; width: 80%; margin-bottom: 10px; }
        button { background: #D40511; color: white; border: none; padding: 15px; font-size: 18px; width: 100%; border-radius: 5px; cursor: pointer; }
        button:disabled { background: #999; }
        .hidden { display: none; }
        
        input[type=range] { width: 100%; height: 30px; accent-color: #D40511; margin: 20px 0; }
        .labels { display: flex; justify-content: space-between; font-weight: bold; font-size: 14px; }
        .lbl-left { color: #27ae60; }
        .lbl-right { color: #D40511; text-align: right; }
        
        #timer_bar { height: 10px; background: #FFCC00; width: 100%; }
    </style>
</head>
<body>
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/DHL_Logo.svg/320px-DHL_Logo.svg.png" width="150">

    <div id="login_screen" class="box">
        <h3>Join Game</h3>
        <input type="text" id="username" placeholder="Your Name">
        <button onclick="joinGame()">Join</button>
        <p id="status_msg" style="color:red; font-size:12px;"></p>
    </div>

    <div id="wait_screen" class="hidden box">
        <h3 id="wait_msg">Waiting for Host...</h3>
    </div>

    <div id="game_screen" class="hidden box">
        <div style="background:#ddd; height:10px;"><div id="timer_bar"></div></div>
        <h3 id="q_text">Question...</h3>
        
        <div class="labels">
            <div class="lbl-left">IDEAL</div>
            <div class="lbl-right">CHALLENGING</div>
        </div>
        <input type="range" id="slider" min="0" max="100" step="100" value="0">
        <p id="slider_val">Selected: IDEAL</p>
        
        <button id="submit_btn" onclick="submitAnswer()">SUBMIT</button>
    </div>

    <div id="feedback_screen" class="hidden box">
        <h2 id="fb_title"></h2>
        <p>Answer: <span id="fb_ans" style="font-weight:bold;"></span></p>
        <h1 id="fb_pts"></h1>
        <p id="fb_bonus" style="color:#D40511; font-weight:bold;"></p>
        <p id="fb_exp" style="font-size:14px; color:#666;"></p>
    </div>

    <script>
        var socket = io();
        var currentTimer;

        // Visual Slider Feedback
        document.getElementById('slider').oninput = function() {
            var txt = this.value == "0" ? "Selected: IDEAL" : "Selected: CHALLENGING";
            document.getElementById('slider_val').innerHTML = txt;
            document.getElementById('slider_val').style.color = this.value == "0" ? "#27ae60" : "#D40511";
        };

        socket.on('connect', function() {
            document.getElementById('status_msg').innerHTML = "Connected to server!";
            setTimeout(() => { document.getElementById('status_msg').innerHTML = ""; }, 2000);
        });

        function joinGame() {
            var name = document.getElementById('username').value;
            if(!name) return;
            socket.emit('join_game', {name: name});
            document.getElementById('login_screen').classList.add('hidden');
            document.getElementById('wait_screen').classList.remove('hidden');
        }

        socket.on('wait_screen', function(data) {
            document.getElementById('wait_msg').innerHTML = data.msg;
            showScreen('wait_screen');
        });

        socket.on('new_question', function(data) {
            showScreen('game_screen');
            document.getElementById('q_text').innerHTML = "Q" + data.q_id + ": " + data.text;
            
            // Reset
            document.getElementById('slider').value = 0;
            document.getElementById('slider_val').innerHTML = "Selected: IDEAL";
            document.getElementById('submit_btn').disabled = false;
            document.getElementById('submit_btn').innerHTML = "SUBMIT";

            // Timer
            var timeLeft = data.duration;
            var bar = document.getElementById('timer_bar');
            bar.style.width = "100%";
            if(currentTimer) clearInterval(currentTimer);
            currentTimer = setInterval(function() {
                timeLeft--;
                bar.style.width = (timeLeft/data.duration * 100) + "%";
                if(timeLeft <= 0) {
                    clearInterval(currentTimer);
                    document.getElementById('submit_btn').disabled = true;
                    document.getElementById('submit_btn').innerHTML = "TIME UP";
                }
            }, 1000);
        });

        function submitAnswer() {
            var val = document.getElementById('slider').value;
            socket.emit('submit_answer', {value: val});
            document.getElementById('submit_btn').disabled = true;
            document.getElementById('submit_btn').innerHTML = "SENT";
        }

        socket.on('feedback', function(data) {
            showScreen('feedback_screen');
            document.getElementById('fb_ans').innerHTML = data.correct_text;
            document.getElementById('fb_pts').innerHTML = "+" + data.points;
            
            var title = document.getElementById('fb_title');
            if(data.correct) {
                title.innerHTML = "âœ… CORRECT";
                title.style.color = "green";
                try { confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: ['#D40511', '#FFCC00'] }); } catch(e){}
            } else {
                title.innerHTML = "âŒ WRONG";
                title.style.color = "red";
            }
            
            var bonusMsg = "";
            if(data.is_fastest) bonusMsg += "âš¡ FASTEST! ";
            if(data.streak_bonus) bonusMsg += "ðŸ”¥ STREAK BONUS! ";
            document.getElementById('fb_bonus').innerHTML = bonusMsg;
            document.getElementById('fb_exp').innerHTML = data.explanation;
        });

        function showScreen(id) {
            ['login_screen','wait_screen','game_screen','feedback_screen'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
        }
    </script>
</body>
</html>
