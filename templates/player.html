<!DOCTYPE html>
<html>
<head>
    <title>DHL Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; text-align: center; padding: 10px; color: #333;
            background: #eee;
        }
        .box { background: white; padding: 20px; border-radius: 8px; margin-top: 20px; border-bottom: 5px solid #D40511; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        input[type=text] { padding: 12px; font-size: 16px; width: 80%; margin-bottom: 10px; border: 2px solid #ddd; border-radius: 4px; }
        button { background: #D40511; color: white; border: none; padding: 15px; font-size: 18px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; text-transform: uppercase; }
        button:disabled { background: #999; cursor: not-allowed; }
        .hidden { display: none; }
        
        /* SLIDER */
        input[type=range] { 
            width: 100%; height: 40px; -webkit-appearance: none; appearance: none;
            background: #ccc; border-radius: 20px; outline: none; margin: 25px 0; cursor: pointer; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 40px; height: 40px;
            background: white; border: 4px solid #555; border-radius: 50%; cursor: pointer;
        }
        .slider-green { background: #2ecc71 !important; }
        .slider-red { background: #D40511 !important; }
        
        .labels { display: flex; justify-content: space-between; font-weight: bold; font-size: 14px; text-transform: uppercase; }
        .lbl-left { color: #2ecc71; text-align: left; }
        .lbl-right { color: #D40511; text-align: right; }
        
        .big-score { font-size: 40px; font-weight: bold; color: #D40511; margin: 10px 0; }
        .bonus-tag { background: #FFCC00; color: #D40511; padding: 5px 10px; border-radius: 15px; font-weight: bold; display: inline-block; margin: 5px; }
    </style>
</head>
<body>
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/2/2c/DHL_Logo.svg/320px-DHL_Logo.svg.png" width="150">

    <div id="login_screen" class="box">
        <h3>Join Game</h3>
        <input type="text" id="username" placeholder="Name">
        <button onclick="joinGame()">Join</button>
    </div>

    <div id="wait_screen" class="hidden box">
        <h3 id="wait_msg">Waiting for Host...</h3>
    </div>

    <div id="game_screen" class="hidden box">
        <h3 id="q_text">Loading...</h3>
        <div class="labels">
            <div class="lbl-left">IDEAL</div>
            <div class="lbl-right">CHALLENGING</div>
        </div>
        
        <input type="range" id="slider" min="0" max="100" step="50" value="50">
        <p id="slider_val" style="font-weight:bold; color:#555;">Slide Left or Right</p>
        
        <button id="submit_btn" onclick="submitAnswer()">SUBMIT ANSWER</button>
    </div>

    <div id="feedback_screen" class="hidden box">
        <h2 id="fb_title"></h2>
        <p>Correct: <span id="fb_ans" style="font-weight:bold;"></span></p>
        <div class="big-score" id="fb_pts"></div>
        <div id="fb_bonuses"></div>
        <p id="fb_exp" style="color:#666; font-style:italic; margin-top:15px; border-top:1px solid #eee; padding-top:10px;"></p>
        <p style="font-size:12px; margin-top:20px;">Waiting for next...</p>
    </div>

    <script>
        var socket = io();

        // SLIDER LOGIC
        var slider = document.getElementById('slider');
        var sliderTxt = document.getElementById('slider_val');
        
        slider.oninput = function() {
            slider.classList.remove('slider-green', 'slider-red');
            if (this.value == "0") {
                slider.classList.add('slider-green');
                sliderTxt.innerHTML = "Selection: IDEAL";
                sliderTxt.style.color = "#2ecc71";
            } else if (this.value == "100") {
                slider.classList.add('slider-red');
                sliderTxt.innerHTML = "Selection: CHALLENGING";
                sliderTxt.style.color = "#D40511";
            } else {
                sliderTxt.innerHTML = "Slide Left or Right";
                sliderTxt.style.color = "#555";
            }
        };

        function joinGame() {
            var name = document.getElementById('username').value;
            if(!name) return alert("Name required");
            socket.emit('join_game', {name: name});
            document.getElementById('login_screen').classList.add('hidden');
            document.getElementById('wait_screen').classList.remove('hidden');
        }

        socket.on('wait_screen', function(data) {
            document.getElementById('wait_msg').innerHTML = data.msg;
            showScreen('wait_screen');
        });

        socket.on('new_question', function(data) {
            showScreen('game_screen');
            document.getElementById('q_text').innerHTML = "Q" + data.q_id + ": " + data.text;
            
            // RESET SLIDER
            slider.value = 50;
            slider.classList.remove('slider-green', 'slider-red');
            sliderTxt.innerHTML = "Slide Left or Right";
            sliderTxt.style.color = "#555";
            
            var btn = document.getElementById('submit_btn');
            btn.disabled = false;
            btn.innerHTML = "SUBMIT ANSWER";
            btn.style.background = "#D40511";
        });

        function submitAnswer() {
            var val = document.getElementById('slider').value;
            if(val == "50") return alert("Move slider first!");
            
            socket.emit('submit_answer', {value: val});
            var btn = document.getElementById('submit_btn');
            btn.disabled = true;
            btn.innerHTML = "WAITING FOR REVEAL...";
            btn.style.background = "#999"; 
        }

        socket.on('feedback', function(data) {
            showScreen('feedback_screen');
            var title = document.getElementById('fb_title');
            if(data.correct) {
                title.innerHTML = "‚úÖ CORRECT";
                title.style.color = "green";
                try { confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#D40511', '#FFCC00'] }); } catch(e){}
            } else {
                title.innerHTML = "‚ùå WRONG";
                title.style.color = "#D40511";
            }
            document.getElementById('fb_ans').innerHTML = data.correct_text;
            document.getElementById('fb_pts').innerHTML = "+" + data.points;
            document.getElementById('fb_exp').innerHTML = data.explanation;
            
            var bHtml = "";
            if(data.is_fastest) bHtml += "<span class='bonus-tag'>‚ö° FASTEST</span>";
            if(data.streak_bonus) bHtml += "<span class='bonus-tag'>üî• STREAK</span>";
            document.getElementById('fb_bonuses').innerHTML = bHtml;
        });

        function showScreen(id) {
            ['login_screen','wait_screen','game_screen','feedback_screen'].forEach(s => {
                document.getElementById(s).classList.add('hidden');
            });
            document.getElementById(id).classList.remove('hidden');
        }
    </script>
</body>
</html>
